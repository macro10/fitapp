# Claude Code Hooks Guide for fitapp

This guide explains the Claude Code hooks configured for the fitapp project. Hooks are shell commands that run automatically at specific points during a Claude Code session, enforcing project rules and automating repetitive tasks.

## Quick start

The hooks are configured in `.claude/settings.json` and the scripts live in `.claude/hooks/`. They activate automatically when you use Claude Code in this project.

To view or manage hooks interactively, type `/hooks` in the Claude Code CLI.

## Configured hooks

### 1. Protect sensitive files (`PreToolUse`)

**Script:** `.claude/hooks/protect-files.sh`
**Fires:** Before any `Edit` or `Write` tool call

Blocks Claude from modifying files that should only be changed manually:

| Protected pattern           | Reason                                         |
| :-------------------------- | :--------------------------------------------- |
| `.env.production`           | Contains production secrets and API URLs        |
| `.env.development`          | Contains local development configuration        |
| `package-lock.json`         | Auto-generated by npm, should not be hand-edited|
| `.git/`                     | Git internals must never be modified directly    |
| `migrations/`               | Django migrations should be generated via CLI    |
| `backend/backend/settings.py` | Core Django settings require careful manual review |

When a blocked edit is attempted, Claude receives feedback explaining why and adjusts its approach (e.g., suggesting you run the command manually instead).

**To customize:** Edit the `PROTECTED_PATTERNS` array in `protect-files.sh`.

### 2. Python syntax check (`PostToolUse`)

**Script:** `.claude/hooks/lint-python.sh`
**Fires:** After any `Edit` or `Write` to a `.py` file

Runs `python3 -m py_compile` on every Python file Claude edits. If there's a syntax error, Claude gets immediate feedback and can fix it in the same turn.

This hook only checks syntax -- it does not enforce style or formatting. To add formatting (e.g., with `black` or `ruff`), install the tool and replace the `py_compile` call:

```bash
# Example: auto-format with black instead of just checking syntax
python3 -m black --quiet "$FILE_PATH" 2>&1
```

### 3. Command logging (`PostToolUse`)

**Script:** `.claude/hooks/log-commands.sh`
**Fires:** After every `Bash` tool call

Logs every shell command Claude executes to `.claude/command-log.txt` with a timestamp. This provides an audit trail of all commands run during a session.

The log file is local-only and should be added to `.gitignore`. Example output:

```
[2026-02-18 14:30:22] python manage.py test
[2026-02-18 14:31:05] npm run build
```

### 4. Context re-injection after compaction (`SessionStart`)

**Script:** `.claude/hooks/compact-context.sh`
**Fires:** When a session resumes after context compaction

When Claude's context window fills up and gets compacted (summarized), important project details can be lost. This hook re-injects key information about the fitapp architecture:

- Tech stack (Django, React, PostgreSQL, etc.)
- Directory structure conventions
- Service layer pattern
- Common commands for running the backend, frontend, and tests

**To customize:** Edit `compact-context.sh` to add current sprint goals, recent decisions, or any context that should survive compaction.

## Adding new hooks

### Using the interactive menu

Type `/hooks` in Claude Code to add, edit, or remove hooks through a guided interface.

### Editing settings directly

Add hooks to `.claude/settings.json`. Available events:

| Event             | When it fires                        | Matcher filters on |
| :---------------- | :----------------------------------- | :----------------- |
| `PreToolUse`      | Before a tool call (can block it)    | Tool name          |
| `PostToolUse`     | After a tool call succeeds           | Tool name          |
| `SessionStart`    | Session begins, resumes, or compacts | Source type        |
| `Notification`    | Claude needs your attention          | Notification type  |
| `Stop`            | Claude finishes responding           | (none)             |
| `UserPromptSubmit`| You submit a prompt                  | (none)             |

### Writing a hook script

Hook scripts receive JSON on stdin with event-specific data. Parse it with `jq`:

```bash
#!/bin/bash
INPUT=$(cat)
FILE_PATH=$(echo "$INPUT" | jq -r '.tool_input.file_path // empty')
```

Exit codes:
- **Exit 0** -- allow the action to proceed
- **Exit 2** -- block the action (write reason to stderr)
- **Other** -- allow, but log stderr for debugging

### Example: add a notification hook

To get desktop notifications when Claude needs input, add this to `~/.claude/settings.json` (user-level, applies to all projects):

```json
{
  "hooks": {
    "Notification": [
      {
        "matcher": "",
        "hooks": [
          {
            "type": "command",
            "command": "notify-send 'Claude Code' 'Claude Code needs your attention'"
          }
        ]
      }
    ]
  }
}
```

### Example: auto-format JavaScript with Prettier

If you add Prettier to the project, create a `PostToolUse` hook to auto-format JS/JSX files:

```json
{
  "matcher": "Edit|Write",
  "hooks": [
    {
      "type": "command",
      "command": "jq -r '.tool_input.file_path' | xargs npx prettier --write 2>/dev/null"
    }
  ]
}
```

## Hook storage locations

| Location                      | Scope           | Committed to git? |
| :---------------------------- | :-------------- | :----------------- |
| `.claude/settings.json`       | This project    | Yes                |
| `.claude/settings.local.json` | This project    | No (gitignored)    |
| `~/.claude/settings.json`     | All projects    | No                 |

## Debugging

- Toggle verbose mode with `Ctrl+O` to see hook output in the transcript
- Run `claude --debug` for full execution details
- Check `.claude/command-log.txt` for the Bash command audit trail
- Test a hook manually: `echo '{"tool_name":"Edit","tool_input":{"file_path":"test.py"}}' | .claude/hooks/protect-files.sh`

## Further reading

- [Hooks guide](https://code.claude.com/docs/en/hooks-guide) -- walkthrough and common patterns
- [Hooks reference](https://code.claude.com/docs/en/hooks) -- full event schemas and JSON formats
